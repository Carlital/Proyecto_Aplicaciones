<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Wizard de configuraci√≥n (transient) -->
    <record id="view_cv_importer_config_form" model="ir.ui.view">
        <field name="name">cv.importer.config.form</field>
        <field name="model">cv.importer.config</field>
        <field name="arch" type="xml">
            <form string="Configuraci√≥n de CV Importer">
                <group>
                    <group string="Configuraci√≥n N8N">
                        <field name="n8n_webhook_url" placeholder="https://n8n.pruebasbidata.site/webhook/process-cv"/>
                        <field name="timeout"/>
                    </group>
                    <group string="Opciones">
                        <field name="auto_apply_data"/>
                    </group>
                </group>

                <div class="alert alert-info">
                    <strong>Ayuda:</strong>
                    <ul>
                        <li><strong>URL Cloud:</strong> https://n8n.pruebasbidata.site/webhook/process-cv</li>
                    </ul>
                </div>

                <footer>
                    <button string="Probar Conexi√≥n" type="object" name="action_test_connection" class="btn-warning"/>
                    <button string="Guardar Configuraci√≥n" type="object" name="action_save_config" class="btn-primary"/>
                    <button string="Cancelar" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Acci√≥n del wizard -->
    <record id="action_cv_importer_config" model="ir.actions.act_window">
        <field name="name">Configuraci√≥n CV Importer</field>
        <field name="res_model">cv.importer.config</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <!-- Men√∫ que abre el wizard -->
    <menuitem id="menu_cv_importer_config"
              name="Configuraci√≥n"
              parent="menu_cv_importer_root"
              action="action_cv_importer_config"
              sequence="20"/>

    <!-- FORM principal de cv.config (modelo persistente) -->
    <record id="view_cv_config_form" model="ir.ui.view">
        <field name="name">cv.config.form.main</field>
        <field name="model">cv.config</field>
        <field name="arch" type="xml">
            <form string="Configuraci√≥n de CV Importer">
                <sheet>
                    <group>
                        <group string="Configuraci√≥n N8N (Free Trial)">
                            <field name="n8n_webhook_url" placeholder="https://n8n.pruebasbidata.site/webhook/process-cv"/>
                            <!-- Mant√©n API key oculta si la usas en futuro -->
                            <field name="n8n_api_key" password="True" invisible="True"/>
                            <div class="alert alert-info" style="margin: 5px 0;">
                                <small><strong>‚ÑπÔ∏è Free Trial:</strong> N8N Free Trial no incluye API key - solo webhook funciona</small>
                            </div>
                        </group>

                        <group string="Procesamiento Local">
                            <field name="local_development"/>
                            <!-- v17: sin attrs; usa expresiones python -->
                            <field name="ngrok_url"
                                   placeholder="https://abc123.ngrok-free.app"
                                   invisible="not local_development"
                                   required="local_development"/>
                        </group>
                    </group>

                    <div class="alert alert-info">
                        <strong>Configuraci√≥n para Desarrollo Local (localhost):</strong>
                        <ul>
                            <li><strong>N8N URL:</strong> https://n8n.pruebasbidata.site/webhook/process-cv</li>
                            <li><strong>Ngrok URL:</strong> Para recibir callbacks de N8N en tu Odoo local</li>
                        </ul>
                        <strong>Flujo:</strong> Odoo (local) ‚Üí N8N (cloud) ‚Üí Ngrok ‚Üí Odoo (local)
                    </div>

                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è Sin Ngrok:</strong> N8N funcionar√° pero los resultados no volver√°n autom√°ticamente a Odoo.
                    </div>

                    <footer>
                        <!-- Si necesitas esconder el bot√≥n fuera de local: -->
                        <button string="üìã Gu√≠a Setup Local" type="object" name="action_setup_local_development"
                                class="btn-info" invisible="not local_development"/>
                        <button string="Probar N8N" type="object" name="action_test_n8n" class="btn-info"/>
                        <button string="Guardar" special="save" class="btn-primary"/>
                        <button string="Cancelar" class="btn-secondary" special="cancel"/>
                    </footer>
                </sheet>
            </form>
        </field>
    </record>

    <!-- TREE de cv.config (opcional) -->
    <record id="view_cv_config_tree" model="ir.ui.view">
        <field name="name">cv.config.tree</field>
        <field name="model">cv.config</field>
        <field name="arch" type="xml">
            <tree string="Configuraciones CV">
                <field name="id"/>
                <field name="n8n_webhook_url"/>
                <field name="local_development"/>
            </tree>
        </field>
    </record>

    <!-- Acci√≥n para abrir listado/form de cv.config -->
    <record id="action_cv_config" model="ir.actions.act_window">
        <field name="name">Configuraci√≥n CV</field>
        <field name="res_model">cv.config</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Configura la integraci√≥n con N8N y el procesamiento local de PDFs
            </p>
        </field>
    </record>

    <!-- Men√∫ directo a cv.config (lista + formulario) -->
    <menuitem id="menu_cv_config"
              name="Configuraci√≥n CV"
              parent="menu_cv_importer_root"
              action="action_cv_config"
              sequence="25"/>
</odoo>
